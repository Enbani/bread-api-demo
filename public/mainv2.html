<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>Bread</title>

    <style>
      body {
        background-color: linen;
      }

      h1 {
        color: maroon;
        margin-left: 40px;
      }
    </style>
  </head>

  <body>
    <button id="lively-bread-button">Pay with bread</button>
    <script>
      function loadScript(src, attrs) {
        return new Promise((resolve, reject) => {
          var existingScript = document.querySelector(`script[src='${src}']`);
          if (existingScript) {
            resolve();
            return;
          }

          var script = document.createElement("script");

          Object.entries({ src, async: "", defer: "", ...attrs })
            .filter(([_, value]) => value != null)
            .forEach((keyValue) => script.setAttribute(...keyValue));

          script.addEventListener("load", function () {
            resolve();
          });
          script.addEventListener("error", function () {
            reject(new Error(src + " failed to load."));
          });
          script.addEventListener("abort", function () {
            reject(new Error(src + " has aborted."));
          });

          document.body.appendChild(script);
        });
      }

      var opts = {
        items: [
          {
            name: "Couch",
            price: 150000,
            sku: "COUCH123",
            imageUrl: "[REPLACEMEWITHAREALURL]",
            detailUrl: "[REPLACEMEWITHAREALURL]",
            quantity: 1,
          },
        ],
      };

      opts.done = function (err, tx_token) {
        if (err) {
          console.error("There was an error: " + err);
          return;
        }
        if (tx_token !== undefined) {
          console.log(tx_token);
        }
        return;
      };

      var el = document.getElementById("lively-bread-button");

      el.addEventListener("click", (ev) => {
        loadScript("https://checkout-sandbox.getbread.com/bread.js", {
          "data-api-key": "21c10a38-7eb2-4478-83e0-ce9a4fed3efe",
        }).then(function () {
          window.bread.showCheckout(opts);
        });
      });
    </script>
  </body>
</html>
